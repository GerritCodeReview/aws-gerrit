{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "c7b88b3b_d884014b",
        "filename": "dual-primary/README.md",
        "patchSetId": 10
      },
      "lineNbr": 276,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-03-15T09:42:56Z",
      "side": 1,
      "message": "out?",
      "range": {
        "startLine": 276,
        "startChar": 21,
        "endLine": 276,
        "endChar": 23
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "84e1b17b_58bdbe76",
        "filename": "dual-primary/README.md",
        "patchSetId": 10
      },
      "lineNbr": 276,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-03-15T10:15:53Z",
      "side": 1,
      "message": "Scaled in is correct, as in \"removed\"\n\n\"Any instances not running any tasks will be removed.\"\n\nDoes it make sense?",
      "parentUuid": "c7b88b3b_d884014b",
      "range": {
        "startLine": 276,
        "startChar": 21,
        "endLine": 276,
        "endChar": 23
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "023b0ac7_831faaa4",
        "filename": "dual-primary/README.md",
        "patchSetId": 10
      },
      "lineNbr": 276,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-03-15T10:34:07Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "84e1b17b_58bdbe76",
      "range": {
        "startLine": 276,
        "startChar": 21,
        "endLine": 276,
        "endChar": 23
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "557415cd_ed6911cf",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 144,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-03-15T09:42:56Z",
      "side": 1,
      "message": "I am trying to understand if we need to add `ManagedTerminationProtection` as well. Maybe you already have an idea about it?",
      "range": {
        "startLine": 144,
        "startChar": 6,
        "endLine": 144,
        "endChar": 30
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f030de32_93c9d23a",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 144,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-03-15T10:15:53Z",
      "side": 1,
      "message": "Yeah I was thinking about this:\n\n\"When managed termination protection is enabled, Amazon ECS prevents the Amazon EC2 instances in an Auto Scaling group that contain tasks from being terminated during a scale-in action.\"\n\nI was thinking that, since we have a targetCapacity of 100 (1 to 1 mapping between tasks and EC2 instances), the ASG can only scale down, when the task has already gone down, so termination protection wouldn\u0027t help because the EC2 instance should always be free from tasks before a scale-in event.\n\nHaving said that:\n- I am planning to make the targetCapacity configurable\n- I am not sure if the ASG scaling event might kick in when the *required* number of tasks goes down, rather than the *actual* number of tasks.\n\nSo I think it would always be safer to have the managed termination protection enabled.\n\nIf you agree I\u0027ll go ahead and set it: At the end of the day, we never want a replica to be brutally terminated right?\n\nWDYT?",
      "parentUuid": "557415cd_ed6911cf",
      "range": {
        "startLine": 144,
        "startChar": 6,
        "endLine": 144,
        "endChar": 30
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "77f4e6c5_366a001c",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 144,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-03-15T10:34:07Z",
      "side": 1,
      "message": "Yep, makes sense. It won\u0027t hurt",
      "parentUuid": "f030de32_93c9d23a",
      "range": {
        "startLine": 144,
        "startChar": 6,
        "endLine": 144,
        "endChar": 30
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "af18aabe_ca38e9a3",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 148,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-03-15T09:42:56Z",
      "side": 1,
      "message": "I think this setting makes sense in our case. What it is not clear to me is how many instances will be added every time we scale up. Where do we set it?",
      "range": {
        "startLine": 147,
        "startChar": 10,
        "endLine": 148,
        "endChar": 35
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cce41493_54100f9b",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 148,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-03-15T10:15:53Z",
      "side": 1,
      "message": "The number of instances will be decided by the capacity provider, depending on the AWS/ECS/ManagedScaling metric.\n\nImaging the replica CPU goes up a lot for a long period of time, then the number of needed replicas will go up to say, 3 instances.\n\nThe capacity provider will need to scale up from 1 to 3: These are boundaries for which that scale up is required.\n\nBasically we are saying \"add one replica at the time. Wait and then add another one if needed\".\n\nAs opposed to \"add two or 3 in a single step\".\n\nDo you think we should make this configurable?",
      "parentUuid": "af18aabe_ca38e9a3",
      "range": {
        "startLine": 147,
        "startChar": 10,
        "endLine": 148,
        "endChar": 35
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e978b550_81fae54c",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 148,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-03-15T10:34:07Z",
      "side": 1,
      "message": "I don\u0027t think we need to make it configurable, at least for the time being. I was wondering if there was a way of saying, for example: add 30% more instances of my current fleet, as you would do in a \"traditional\" ASG.",
      "parentUuid": "cce41493_54100f9b",
      "range": {
        "startLine": 147,
        "startChar": 10,
        "endLine": 148,
        "endChar": 35
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6da0a73c_5b56a3ba",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 148,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-03-15T12:55:48Z",
      "side": 1,
      "message": "Nope, because basically you are delegating the scaling to the capacity provider, so it\u0027s not up to you to specify this type of strategies. As far as I understand it you can only specifying what are the boundaries into which the capacity provider can move.\n\nHope it makes sense.\n\nHowever, I decided to make those parameters configurable, because depending on the shape of your workload, you might have sudden spikes for which one instance at a time might not be enough (i.e. many jenkins jobs triggered at the same time).",
      "parentUuid": "e978b550_81fae54c",
      "range": {
        "startLine": 147,
        "startChar": 10,
        "endLine": 148,
        "endChar": 35
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1edeb137_f67abe4e",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 148,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-03-15T12:58:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6da0a73c_5b56a3ba",
      "range": {
        "startLine": 147,
        "startChar": 10,
        "endLine": 148,
        "endChar": 35
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "679f2b7b_b1bfb1fc",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 150,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-13T01:50:28Z",
      "side": 1,
      "message": "Do we really want to scale up only when we are 100%? I believe it would be a bit too late.",
      "range": {
        "startLine": 150,
        "startChar": 10,
        "endLine": 150,
        "endChar": 29
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8aa73073_8be9209f",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 150,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-03-15T08:54:27Z",
      "side": 1,
      "message": "Let\u0027s make sure we interpret this value in the same way.\n\nTargetCapacity \u003d 100 does not mean \"scale when CPU usage is 100%\" (CPU Usage drives when to scale *tasks*, not when to scale the ASG).\n\nTargetCapacity \u003d 100 just means that we don\u0027t want any _spare capacity_ on the ASG.\n\nIf 3 replica tasks are needed, then the ASG will adjust to have exactly 3 EC2.\n\nTargetCapacity less than 100 enables spare capacity in the ASG. For example, if you set the TargetCapacity \u003d 50 the scaling policy will adjust the EC2 until it is exactly twice the number of instances needed to run all of the tasks:\n\nIf 3 replica tasks are needed, then there ASG will adjust to 6 EC2.\n\nIt boils down to how quickly one wants to be able to scale:\n\n* Setting targetCapacity to \u003c 100 will allow to *pre-scale* the ASG so that there is always an EC2 instance ready to run an additional task. Pay more, but scale faster.\n\n* Setting targetCapacity \u003d 100 will be more economic (you don\u0027t run any spare EC2 instance). Pay less, but scale more slowly.\n\nPerhaps we should make this configurable?",
      "parentUuid": "679f2b7b_b1bfb1fc",
      "range": {
        "startLine": 150,
        "startChar": 10,
        "endLine": 150,
        "endChar": 29
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e98f681e_5cc51c25",
        "filename": "dual-primary/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 150,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-03-15T12:58:41Z",
      "side": 1,
      "message": "I have made this configurable.",
      "parentUuid": "8aa73073_8be9209f",
      "range": {
        "startLine": 150,
        "startChar": 10,
        "endLine": 150,
        "endChar": 29
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b54471de_ad506fad",
        "filename": "primary-replica/README.md",
        "patchSetId": 10
      },
      "lineNbr": 148,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2021-03-15T09:42:56Z",
      "side": 1,
      "message": "out?",
      "range": {
        "startLine": 148,
        "startChar": 21,
        "endLine": 148,
        "endChar": 23
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a79ac58a_4028d7c0",
        "filename": "primary-replica/README.md",
        "patchSetId": 10
      },
      "lineNbr": 148,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-03-15T10:15:53Z",
      "side": 1,
      "message": "See above.",
      "parentUuid": "b54471de_ad506fad",
      "range": {
        "startLine": 148,
        "startChar": 21,
        "endLine": 148,
        "endChar": 23
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9adfabda_3b0ca063",
        "filename": "primary-replica/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 126,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-13T01:50:28Z",
      "side": 1,
      "message": "Same as above: do we want to wait to reach 100% utilisation before scaling up?",
      "range": {
        "startLine": 126,
        "startChar": 10,
        "endLine": 126,
        "endChar": 29
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f2b4fc06_38193512",
        "filename": "primary-replica/cf-cluster.yml",
        "patchSetId": 10
      },
      "lineNbr": 126,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-03-15T08:54:27Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "9adfabda_3b0ca063",
      "range": {
        "startLine": 126,
        "startChar": 10,
        "endLine": 126,
        "endChar": 29
      },
      "revId": "df45cad46935e3e1a6af296e763466a46638e2c9",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}