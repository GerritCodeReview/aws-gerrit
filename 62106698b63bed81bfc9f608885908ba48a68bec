{
  "comments": [
    {
      "key": {
        "uuid": "92a7473e_2338d780",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2020-08-14T17:58:38Z",
      "side": 1,
      "message": "Is this meant to be part of the dual-master recipe? If so, I suppose the dual master recipe will evolve into a more generic multi-master/multi-site recipe. Is my assumption correct?",
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "39baec9a_ab9343b2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-14T18:02:52Z",
      "side": 1,
      "message": "Yes, exactly my thinking was that \"multi-site\" recipe will just be two deployments of dual-master with replication and multi-site capabilities.\n\nAs in, if you have another gerrit site somewhere (which possibly you deployed using the same recipe, in a different region), you can \"point\" to it.\n\nThis change allows to be \"pointed to\" by exposing a replication service.\nThe next one allows to \"point to\" by configuring the replication.config accordingly.\n\nThen on top of this we\u0027ll need another CR to configure multi-site plugins and that should be it.\n\nHope it makes sense.",
      "parentUuid": "92a7473e_2338d780",
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "542ce8e1_bc1693a2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2020-08-14T18:27:07Z",
      "side": 1,
      "message": "Makes sense. My concerne is that we will have to add loads of logic in the wrapping script to accomodate the different setup you might end up with.\n\nThat was the reason why, for example, single-master and dual-master has been treated as different recipe. single-master as well it is just a simple version of dual-master, hence we could have used a single recipe with some extra logic in the wrapping scripts.\n\nOff course the price to pay in having separate recipes is repetition of the CFs. The aim of shared templates was to reduce the repetition.",
      "parentUuid": "39baec9a_ab9343b2",
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4b79bee2_72e06700",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-14T21:12:58Z",
      "side": 1,
      "message": "Good work @Tony. Just some minor issues.\n\nHave you checked also that the recipe still works fine *without* replication?",
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d7a1fe60_54d3d90b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-15T09:52:41Z",
      "side": 1,
      "message": "Yes I have tested that thoroughly, it does work without replication.",
      "parentUuid": "4b79bee2_72e06700",
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4aba9b9d_10a5a319",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-15T09:52:41Z",
      "side": 1,
      "message": "I see your point @ponch. I think both approaches have trade-offs.\n\nI chose to extend the dual-master recipe rather than creating a new one from scratch because 100% of the existing CF would have been copied over, whilst accommodating the \"extra\" part seemed just a matter of few conditional values and Ifs (If you look at the diff of this change you\u0027ll see that only has a minor change to the Makefile and it doesn\u0027t even touch any other cf template).\n\nI think the benefit of this approach is that we have less code to maintain and we can triage/fix both recipes in an easier way: there\u0027s already *loads\" of repetition among recipes and I wanted to contain this to go even further.\n\nExtensive use of shared templates could be an approach (or CDK), but it would require some refactoring on the existing code and I thought it was out of the scope of this change.\n\n@luca, @marcin, @ponch WDYT?",
      "parentUuid": "542ce8e1_bc1693a2",
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "83feaa37_ac6e30c2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2020-08-17T16:38:58Z",
      "side": 1,
      "message": "I was trying to put myself in the shoes of the final user...as a user I would like something that just works out of the box with minimum configuration, i.e.: the less parameters I need to set the better. If you think selecting dual-master Vs multi-site won\u0027t require too many additional parameters I think it is ok.",
      "parentUuid": "4aba9b9d_10a5a319",
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bc197f26_9c387e1b",
        "filename": "dual-master/Makefile",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-14T21:12:58Z",
      "side": 1,
      "message": "Those aren\u0027t needed if REPLICATION_SERVICE_ENABLED is false",
      "range": {
        "startLine": 14,
        "startChar": 0,
        "endLine": 14,
        "endChar": 120
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0475b6ef_068b9e5d",
        "filename": "dual-master/Makefile",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-15T09:52:41Z",
      "side": 1,
      "message": "Yes, but this is just the list of phony targets: they should be all mentioned in the phony target to indicate that they won\u0027t produce any file.",
      "parentUuid": "bc197f26_9c387e1b",
      "range": {
        "startLine": 14,
        "startChar": 0,
        "endLine": 14,
        "endChar": 120
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "13ac35b4_f846b544",
        "filename": "dual-master/Makefile",
        "patchSetId": 10
      },
      "lineNbr": 14,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-18T07:37:46Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "0475b6ef_068b9e5d",
      "range": {
        "startLine": 14,
        "startChar": 0,
        "endLine": 14,
        "endChar": 120
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "618462fc_33fe4b09",
        "filename": "dual-master/Makefile",
        "patchSetId": 10
      },
      "lineNbr": 379,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-14T21:12:58Z",
      "side": 1,
      "message": "Those are not needed if SERVICE_REPLICATION_ENABLED is false",
      "range": {
        "startLine": 379,
        "startChar": 0,
        "endLine": 379,
        "endChar": 72
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cf78069b_86e4e694",
        "filename": "dual-master/Makefile",
        "patchSetId": 10
      },
      "lineNbr": 379,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-15T09:52:41Z",
      "side": 1,
      "message": "Whilst this is true, I thought it was better to always make sure they are deleted (A recipe *might* have been previously created with those targets for example, despite the _current_ setup configuration).\nWhen they don\u0027t exist it will be just a noop, so I think it just make the deletion operation more solid.\n\nWDYT?",
      "parentUuid": "618462fc_33fe4b09",
      "range": {
        "startLine": 379,
        "startChar": 0,
        "endLine": 379,
        "endChar": 72
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1a9770c9_21a48580",
        "filename": "dual-master/Makefile",
        "patchSetId": 10
      },
      "lineNbr": 379,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-18T07:37:46Z",
      "side": 1,
      "message": "Have you verified that the deletion of a non-existent stack won\u0027t fail?",
      "parentUuid": "cf78069b_86e4e694",
      "range": {
        "startLine": 379,
        "startChar": 0,
        "endLine": 379,
        "endChar": 72
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2885ba42_34246118",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 15,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-14T21:12:58Z",
      "side": 1,
      "message": "Would it be better to mention SERVICE_REPLICATION_ENABLED\u003dtrue as condition?",
      "range": {
        "startLine": 15,
        "startChar": 16,
        "endLine": 15,
        "endChar": 47
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1cd7cc9c_010b9215",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 15,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-15T09:52:41Z",
      "side": 1,
      "message": "I will add a link to the relevant configuration section where more information can be gathered.",
      "parentUuid": "2885ba42_34246118",
      "range": {
        "startLine": 15,
        "startChar": 16,
        "endLine": 15,
        "endChar": 47
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cab3dfdd_465166c3",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 115,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2020-08-14T18:03:35Z",
      "side": 1,
      "message": "Can we have more than one replication task? How will the port allocation works?",
      "range": {
        "startLine": 115,
        "startChar": 3,
        "endLine": 115,
        "endChar": 36
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c3c06e65_1ba40418",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 115,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-14T18:05:08Z",
      "side": 1,
      "message": "My understanding is that ECS will allocate the tasks where it is possible (i.e. no collisions).\nIf that\u0027s not possible because the cluster is too small, then it will report an error.\n\nI will test this.",
      "parentUuid": "cab3dfdd_465166c3",
      "range": {
        "startLine": 115,
        "startChar": 3,
        "endLine": 115,
        "endChar": 36
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "742f88c4_df4ff27e",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 115,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2020-08-14T18:08:35Z",
      "side": 1,
      "message": "The problem is that ECS will try to spin up another task using the same ports, unless I am missing something. This will end up in a collision since the ports are already in use and ECS won\u0027t be able to spin up more than one task.",
      "parentUuid": "c3c06e65_1ba40418",
      "range": {
        "startLine": 115,
        "startChar": 3,
        "endLine": 115,
        "endChar": 36
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6d7ab854_c1cf250d",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 115,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-14T18:09:50Z",
      "side": 1,
      "message": "yes it will try to spin a new task *on an EC2 that doesn\u0027t have those ports allocated*.\nIf it can\u0027t it will produce an error.\n\nIs this not your understanding?",
      "parentUuid": "742f88c4_df4ff27e",
      "range": {
        "startLine": 115,
        "startChar": 3,
        "endLine": 115,
        "endChar": 36
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6dcc02c7_fd206175",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 115,
      "author": {
        "id": 1054778
      },
      "writtenOn": "2020-08-14T18:13:29Z",
      "side": 1,
      "message": "Aaa ok, no that wasn\u0027t my understanding. I didn\u0027t know ECS does this kind of checks.",
      "parentUuid": "6d7ab854_c1cf250d",
      "range": {
        "startLine": 115,
        "startChar": 3,
        "endLine": 115,
        "endChar": 36
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6443ddf6_fd12f389",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 115,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-14T21:12:58Z",
      "side": 1,
      "message": "This is an interesting point: one may want to scale up the replication service if needed. Good to know that ECS would manage that. @Tony have you tried with more than one? Does it work?",
      "parentUuid": "6dcc02c7_fd206175",
      "range": {
        "startLine": 115,
        "startChar": 3,
        "endLine": 115,
        "endChar": 36
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "32537f9a_43c9bb4a",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 115,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-15T09:52:41Z",
      "side": 1,
      "message": "Yes I tested this and it works.\nI have deployed dual-master with service replication enabled and a desired count of 2[1].\nECS placement strategy placed one one one EC2 instance[2] and one on another[3].\n\nECS has a concept of placement-strategy (which can also be tweaked). The first thing it will do is:\n\n`Identify the instances that satisfy the CPU, memory, and port requirements in the task definition.`\n\nYou can see more details in the AWS official docs[4]\n\n[1] https://ibb.co/ftVJPKc\n[2] https://ibb.co/C5xMtjc\n[3] https://ibb.co/QXtf5Yv\n[4] https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task-placement.html",
      "parentUuid": "6443ddf6_fd12f389",
      "range": {
        "startLine": 115,
        "startChar": 3,
        "endLine": 115,
        "endChar": 36
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "97d0b35e_68af477c",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 115,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-18T07:37:46Z",
      "side": 1,
      "message": "Good stuff!",
      "parentUuid": "32537f9a_43c9bb4a",
      "range": {
        "startLine": 115,
        "startChar": 3,
        "endLine": 115,
        "endChar": 36
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "35e6e64c_ba08d3cd",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 140,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-14T21:12:58Z",
      "side": 1,
      "message": "onto the share EFS volume",
      "range": {
        "startLine": 140,
        "startChar": 59,
        "endLine": 140,
        "endChar": 80
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ef8ba24f_339ea842",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 140,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-15T09:52:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "35e6e64c_ba08d3cd",
      "range": {
        "startLine": 140,
        "startChar": 59,
        "endLine": 140,
        "endChar": 80
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3ef6c900_c0d28a10",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 157,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-14T21:12:58Z",
      "side": 1,
      "message": "VPC",
      "range": {
        "startLine": 157,
        "startChar": 29,
        "endLine": 157,
        "endChar": 32
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cc39eaf4_40e13920",
        "filename": "dual-master/README.md",
        "patchSetId": 10
      },
      "lineNbr": 157,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-15T09:52:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3ef6c900_c0d28a10",
      "range": {
        "startLine": 157,
        "startChar": 29,
        "endLine": 157,
        "endChar": 32
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ad97c78b_bdd9eccc",
        "filename": "dual-master/cf-service-replication.yml",
        "patchSetId": 10
      },
      "lineNbr": 2,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-08-14T21:12:58Z",
      "side": 1,
      "message": "onto",
      "range": {
        "startLine": 2,
        "startChar": 42,
        "endLine": 2,
        "endChar": 46
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "67d5e08e_ded3db8f",
        "filename": "dual-master/cf-service-replication.yml",
        "patchSetId": 10
      },
      "lineNbr": 2,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2020-08-15T09:52:41Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ad97c78b_bdd9eccc",
      "range": {
        "startLine": 2,
        "startChar": 42,
        "endLine": 2,
        "endChar": 46
      },
      "revId": "62106698b63bed81bfc9f608885908ba48a68bec",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}